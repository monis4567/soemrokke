# Gstacks - Processing single-end data, already alligned to a reference genome. 
# Using 2.clean.bam files from the folder after Bedtools comparison and sorting. 
# Clean .bam files are moved into a seperate folder where gstacks is ran, as stacks compare all files in the folder, only have the wanted files present. 

# Loading modules 
module load stacks/v2.3b

# Running gstacks to build loci from the aligned single-end data.
gstacks -I /groups/hologenomics/andreasp/data/mapping/clean_clavata/ -M /groups/hologenomics/andreasp/data/mapping/clavata_popmap.txt -S .GCF_010909765.2.clean.bam -O /groups/hologenomics/andreasp/data/mapping/clavata_stacks/ -t 8

## I: Is the input folder, where all the clean .bam files are located.
## M: Is the path to the popmap, the popmap consists of the prefix ID with an allocating coulumn with area. In this case either NS = North Sea, SK = Skagerrak, KG = Kattegat or AQ = Aquarium.
## O: Is the path where stacks places the output.
## S: Is the suffix needed. Stacks assume the files to in the format "sample_number.bam".

# Running populations. 
# Calculating Hardy-Weinberg deviation, population statistics, f-statistics and # smooth the statistics across the genome. Export several output files.
populations -P /groups/hologenomics/andreasp/data/mapping/clavata_stacks/ -M /groups/hologenomics/andreasp/data/mapping/clavata_popmap.txt -r 0.65 --vcf --genepop --fstats --smooth --hwe -t 8
